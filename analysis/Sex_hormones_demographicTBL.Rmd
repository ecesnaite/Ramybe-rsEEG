---
title: "Demographic_corr_horm"
output:
date: "2023-07-15"
---

```{r warning=FALSE, include=FALSE, paged.print=FALSE}
library(tidyverse)
library(dplyr)
library(ggpubr)
library(rstatix)
library(broom)
library(readxl)
library(gtsummary)
```

## Load data


```{r paged.print=FALSE}
slope <-  
   read_xlsx("C:/Users/Rokas/Desktop/Mantes dokumentai/Dok. reikalingi failai/Resting_state/slope_off_ch_groups.xlsx", sheet = "id_group_median_slope")

offset <-
  read_xlsx("C:/Users/Rokas/Desktop/Mantes dokumentai/Dok. reikalingi failai/Resting_state/slope_off_ch_groups.xlsx", sheet = "id_group_median_offset")

iaf <-read_xlsx("C:/Users/Rokas/Desktop/Mantes dokumentai/Dok. reikalingi failai/Resting_state/iaf_power_ch_groups.xlsx", sheet = "id_group_median_iaf" )

power <-read_xlsx("C:/Users/Rokas/Desktop/Mantes dokumentai/Dok. reikalingi failai/Resting_state/iaf_power_ch_groups.xlsx", sheet = "id_group_median_power" )

demographic <-read_xlsx("C:/Users/Rokas/Desktop/Mantes dokumentai/Dok. reikalingi failai/Resting_state/id_age.xlsx")
```

## Merge data sets

You can also embed plots, for example:

```{r paged.print=FALSE, warning=FALSE}
#merge variables
All_data <- merge(slope,offset, by = "id", all.x = TRUE) %>%
merge(iaf, by = "id", all.x = TRUE)  %>%
merge(power, by = "id", all.x = TRUE)  %>%
merge(demographic, by = "id", all.x = TRUE)   

##logtransform_power
All_data$powerLog=log(All_data$median_power)
```
** remove_subjects**
NCF_236, OC_32.set, UID_107.set, UID_113.set
```{r paged.print=TRUE} 
ids_to_remove <- c(236, 32, 107, 113, 221, 13, 118, 122)
All_data <- All_data[,-c(4,6, 8)]
All_data <- All_data[!(All_data$id %in% ids_to_remove) & !(All_data$group == "M"), ]
```
## Demographic table
```{r}
DemoTbl<-select(All_data, c(age, Progesterone, Estradiol, Testosterone, group.x))

tbl_summary_1 <- DemoTbl %>%
  tbl_summary(
    by = group.x,
    missing = "no",
    statistic = list(
      all_continuous() ~ "{mean} ({sd})"))%>%
  add_p(test = all_continuous() ~ "aov",
        pvalue_fun = function(x) style_pvalue(x, digits = 2))
tbl_summary_1
```
**ANOVA for age **
```{r}
library(rcompanion)
Age_anova <- aov(age ~ group.x, data = All_data)
summary(Age_anova)
# Perform Tukey's HSD post-hoc test
TukeyHSD(Age_anova)
# Perform pairwise comparisons with Bonferroni correction
pairwise.t.test(All_data$age, All_data$group.x, p.adj = "bonferroni")

```
** ANOVA** for Progesterone
```{r}
Progesterone_anova <- aov(Progesterone ~ group.x, data = All_data)
summary(Progesterone_anova)
# Perform Tukey's HSD post-hoc test
TukeyHSD(Progesterone_anova)
# Perform pairwise comparisons with Bonferroni correction
pairwise.t.test(All_data$Progesterone, All_data$group.x, p.adj = "bonferroni")

```
**ANOVA for Testosterona**
```{r}
Testosterone_anova <- aov(Testosterone ~ group.x, data = All_data)
summary(Testosterone_anova)
# Perform Tukey's HSD post-hoc test
TukeyHSD(Testosterone_anova)
# Perform pairwise comparisons with Bonferroni correction
pairwise.t.test(All_data$Testosterone, All_data$group.x, p.adj = "bonferroni")

```
#histograms of sex hormones and distribution test#
```{r}
hist(All_data$Progesterone)## need to log transform
  All_data$ProgesteroneLog=log(All_data$Progesterone)
  hist(All_data$ProgesteroneLog) ## for correlation analysis to use log transformed data
hist(All_data$Estradiol)
hist(All_data$Testosterone)

#parametriÅ¡kumo testas
shapiro.test(All_data$ProgesteroneLog)
shapiro.test(All_data$Estradiol)
shapiro.test(All_data$Testosterone)
```
#outliers in hormones
*estradiolis*
```{r}
boxplot(All_data$Estradiol,
  ylab = "Estradiol",
  main = "Box plot"
)
boxplot.stats(All_data$Estradiol)$out
```
*testosterone*
```{r}
boxplot(All_data$Testosterone,
  ylab = "Testosteronas",
  main = "Box plot"
)
boxplot.stats(All_data$Testosterone)$out

```
# Correlatio
```{r warning=FALSE}
library(corrplot)
library(PerformanceAnalytics)
corr_data<-All_data[, c("ProgesteroneLog", "Estradiol", "Testosterone","median_iaf", "powerLog", "median_slope")]
cor_matrix <- cor(corr_data,method = "spearman", use = "pairwise.complete.obs")
p_values <- cor.mtest(corr_data, method = "spearman",  use = "pairwise.complete.obs")$p
cor_p_matrix <- cbind(cor_matrix, p_values)
round(print(cor_p_matrix),3)
```
**plot matrix**
```{r warning=FALSE}
corrplot(cor_matrix, p.mat = p_values, sig.level = 0.05, insig = "blank")
chart.Correlation(corr_data, histogram=TRUE, pch=19)
```


## GLM ##
*Multiple linear regression*
**IAF**
```{r}
library(performance)
library(see)
library(patchwork)
library(car)
data_dummies <- cbind(All_data, model.matrix(~ group.x - 1, All_data))
model_IAF <- lm(median_iaf ~ ProgesteroneLog + Estradiol + Testosterone + group.xIUD + group.xOC+group.xNCL, data = data_dummies)
summary(model_IAF)
```
**model_IAF check**
```{r}
check_model(model_IAF)
```
**powerLog**
```{r}
model_powerLog <- lm(powerLog ~ ProgesteroneLog + Estradiol + Testosterone + group.xIUD + group.xOC+group.xNCL, data = data_dummies)
summary(model_powerLog)
```
**powerLog check**
```{r}
check_model(model_powerLog)
```
**Slope**
```{r}
model_slope <- lm(median_slope ~ ProgesteroneLog + Estradiol + Testosterone + group.xIUD + group.xOC+group.xNCF, data = data_dummies)
summary(model_slope)
```
**slope check**
```{r}
check_model(model_slope)
```